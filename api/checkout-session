<button id="btn-one-time">Einmalzahlung (499 €)</button>
<button id="btn-split-2">2 Raten à 257,50 € (Gesamt 515 €)</button>
<button id="btn-split-3">3 Raten à 175 € (Gesamt 525 €)</button>

<div id="stripe-checkout" style="margin-top:24px;"></div>

<script src="https://js.stripe.com/v3/"></script>
<script>
  const PUBLISHABLE_KEY = "pk_test_…"; // dein Stripe Publishable Key
  const API_URL = "https://aibe-checkout.vercel.app/api/checkout-session"; // deine Vercel-URL

  async function startCheckout(plan) {
    // Funnel-Signale (optional, aber gut)
    if (window.fbq) {
      fbq('trackCustom', 'CTA_Click_Buy', { plan });
      fbq('track', 'InitiateCheckout', { plan });
    }

    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ plan })
    });
    const data = await res.json();
    if (!data.client_secret) {
      alert("Checkout konnte nicht erstellt werden.");
      return;
    }

    const stripe = Stripe(PUBLISHABLE_KEY);
    const checkout = await stripe.initEmbeddedCheckout({ clientSecret: data.client_secret });
    checkout.mount("#stripe-checkout");
  }

  document.getElementById("btn-one-time").onclick = () => startCheckout("one_time");
  document.getElementById("btn-split-2").onclick  = () => startCheckout("split_2");
  document.getElementById("btn-split-3").onclick  = () => startCheckout("split_3");
</script>
